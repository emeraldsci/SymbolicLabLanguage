/*! @name @videojs/plugin-concat @version 1.0.0 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/window"],e):(t=t||self).pluginConcat=e(t.videojs,t.window)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var r=function(e,r){e=e.filter(function(t,e,r){return r.indexOf(t)===e});var i=!1,n={},a=[];e.forEach(function(s){var u=t.xhr(s,function(t,o){if(!i){a.splice(a.indexOf(u),1);var c=o&&(200===o.statusCode||206===o.statusCode||0===o.statusCode);if(t||!c)return r({message:t?t.message:"Request failed",request:u}),i=!0,void a.forEach(function(t){return t.abort()});n[s]=u.responseText,Object.keys(n).length===e.length&&r(null,n)}});a.push(u)})},i=function(t){return!!t&&"object"==typeof t},n=function t(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.reduce(function(e,r){return Object.keys(r).forEach(function(n){Array.isArray(e[n])&&Array.isArray(r[n])?e[n]=e[n].concat(r[n]):i(e[n])&&i(r[n])?e[n]=t(e[n],r[n]):e[n]=r[n]}),e},{})},a=function(t){return t.reduce(function(t,e){return t.concat(e)},[])},s=function(t){if(!t.length)return[];for(var e=[],r=0;r<t.length;r++)e.push(t[r]);return e},u="INVALID_NUMBER_OF_PERIOD",o="DASH_EMPTY_MANIFEST",c="DASH_INVALID_XML",l="NO_BASE_URL",d="SEGMENT_TIME_UNSPECIFIED";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var f,p=(function(t,e){var r,i,n,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var u=s.parseURL(t);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&"/"!==u.path[0]){var o=i.exec(u.path);u.netLoc=o[1],u.path=o[2]}u.netLoc&&!u.path&&(u.path="/");var c={scheme:u.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=u.netLoc,"/"!==a.path[0]))if(a.path){var l=u.path,d=l.substring(0,l.lastIndexOf("/")+1)+a.path;c.path=s.normalizePath(d)}else c.path=u.path,a.params||(c.params=u.params,a.query||(c.query=u.query));return null===c.path&&(c.path=r.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(c)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s}(f={exports:{}},f.exports),f.exports),m=function(t,r){return/^[a-z]+:/i.test(r)?r:(/\/\//i.test(t)||(t=p.buildAbsoluteURL(e.location.href,t)),p.buildAbsoluteURL(t,r))},g=function(t){var e=t.baseUrl,r=void 0===e?"":e,i=t.source,n=void 0===i?"":i,a=t.range,s=void 0===a?"":a,u=t.indexRange,o=void 0===u?"":u,c={uri:n,resolvedUri:m(r||"",n)};if(s||o){var l=(s||o).split("-"),d=parseInt(l[0],10),f=parseInt(l[1],10);c.byterange={length:f-d+1,offset:d}}return c},h={static:function(t){var e=t.duration,r=t.timescale,i=void 0===r?1:r,n=t.sourceDuration;return{start:0,end:Math.ceil(n/(e/i))}},dynamic:function(t){var e=t.NOW,r=t.clientOffset,i=t.availabilityStartTime,n=t.timescale,a=void 0===n?1:n,s=t.duration,u=t.start,o=void 0===u?0:u,c=t.minimumUpdatePeriod,l=void 0===c?0:c,d=t.timeShiftBufferDepth,f=void 0===d?1/0:d,p=(e+r)/1e3,m=i+o,g=p+l-m,h=Math.ceil(g*a/s),v=Math.floor((p-m-f)*a/s),b=Math.floor((p-m)*a/s);return{start:Math.max(0,v),end:Math.min(h,b)}}},v=function(t){var e=t.type,r=void 0===e?"static":e,i=t.duration,n=t.timescale,a=void 0===n?1:n,s=t.sourceDuration,u=h[r](t),o=function(t,e){for(var r=[],i=t;i<e;i++)r.push(i);return r}(u.start,u.end).map(function(t){return function(e,r){var i=t.duration,n=t.timescale,a=void 0===n?1:n,s=t.periodIndex,u=t.startNumber;return{number:(void 0===u?1:u)+e,duration:i/a,timeline:s,time:r*i}}}(t));if("static"===r){var c=o.length-1;o[c].duration=s-i/a*c}return o},b=function(t){var e=t.baseUrl,r=t.initialization,i=void 0===r?{}:r,n=t.sourceDuration,a=t.timescale,s=void 0===a?1:a,u=t.indexRange,o=void 0===u?"":u,c=t.duration;if(!e)throw new Error(l);var d=g({baseUrl:e,source:i.sourceURL,range:i.range}),f=g({baseUrl:e,source:e,indexRange:o});if(f.map=d,c){var p=v(t);p.length&&(f.duration=p[0].duration,f.timeline=p[0].timeline)}else n&&(f.duration=n/s,f.timeline=0);return f.number=0,[f]},y=function(t,e,r){for(var i=t.sidx.map?t.sidx.map:null,n=t.sidx.duration,a=t.timeline||0,s=t.sidx.byterange,u=s.offset+s.length,o=e.timescale,c=e.references.filter(function(t){return 1!==t.referenceType}),l=[],d=u+e.firstOffset,f=0;f<c.length;f++){var p=e.references[f],m=p.referencedSize,g=p.subsegmentDuration,h=b({baseUrl:r,timescale:o,timeline:a,periodIndex:a,duration:g,sourceDuration:n,indexRange:d+"-"+(d+m-1)})[0];i&&(h.map=i),l.push(h),d+=m}return t.segments=l,t},T=function(t){var e;return(e=t.reduce(function(t,e){var r,i=e.attributes.id+(e.attributes.lang||"");t[i]?(e.segments[0]&&(e.segments[0].discontinuity=!0),(r=t[i].segments).push.apply(r,e.segments),e.attributes.contentProtection&&(t[i].attributes.contentProtection=e.attributes.contentProtection)):t[i]=e;return t},{}),Object.keys(e).map(function(t){return e[t]})).map(function(t){var e,r;return t.discontinuityStarts=(e=t.segments,r="discontinuity",e.reduce(function(t,e,i){return e[r]&&t.push(i),t},[])),t})},E=function(t,e){if(void 0===e&&(e={}),!Object.keys(e).length)return t;for(var r in t){var i=t[r];if(i.sidx){var n=i.sidx.uri+"-"+(s=i.sidx.byterange,u=void 0,u=s.offset+s.length-1,s.offset+"-"+u),a=e[n]&&e[n].sidx;i.sidx&&a&&y(i,a,i.sidx.resolvedUri)}}var s,u;return t},I=function(t){var e,r=t.attributes,i=t.segments,n=t.sidx,a={attributes:(e={NAME:r.id,BANDWIDTH:r.bandwidth,CODECS:r.codecs},e["PROGRAM-ID"]=1,e),uri:"",endList:"static"===(r.type||"static"),timeline:r.periodIndex,resolvedUri:"",targetDuration:r.duration,segments:i,mediaSequence:i.length?i[0].number:1};return r.contentProtection&&(a.contentProtection=r.contentProtection),n&&(a.sidx=n),a},U=function(t){var e,r=t.attributes,i=t.segments,n=t.sidx,a={attributes:(e={NAME:r.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:r.width,height:r.height},CODECS:r.codecs,BANDWIDTH:r.bandwidth},e["PROGRAM-ID"]=1,e),uri:"",endList:"static"===(r.type||"static"),timeline:r.periodIndex,resolvedUri:"",targetDuration:r.duration,segments:i,mediaSequence:i.length?i[0].number:1};return r.contentProtection&&(a.contentProtection=r.contentProtection),n&&(a.sidx=n),a},O=function(t,e){var r;if(void 0===e&&(e={}),!t.length)return{};var i=t[0].attributes,n=i.sourceDuration,a=i.minimumUpdatePeriod,s=void 0===a?0:a,u=T(t.filter(function(t){var e=t.attributes;return"video/mp4"===e.mimeType||"video"===e.contentType})).map(U),o=T(t.filter(function(t){var e=t.attributes;return"audio/mp4"===e.mimeType||"audio"===e.contentType})),c=t.filter(function(t){var e=t.attributes;return"text/vtt"===e.mimeType||"text"===e.contentType}),l={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(r={AUDIO:{},VIDEO:{}},r["CLOSED-CAPTIONS"]={},r.SUBTITLES={},r),uri:"",duration:n,playlists:E(u,e),minimumUpdatePeriod:1e3*s};return o.length&&(l.mediaGroups.AUDIO.audio=function(t,e){var r;void 0===e&&(e={});var i=t.reduce(function(t,i){var n=i.attributes.role&&i.attributes.role.value||"",a=i.attributes.lang||"",s="main";if(a){var u=n?" ("+n+")":"";s=""+i.attributes.lang+u}return t[s]&&t[s].playlists[0].attributes.BANDWIDTH>i.attributes.bandwidth?t:(t[s]={language:a,autoselect:!0,default:"main"===n,playlists:E([I(i)],e),uri:""},void 0===r&&"main"===n&&((r=i).default=!0),t)},{});r||(i[Object.keys(i)[0]].default=!0);return i}(o,e)),c.length&&(l.mediaGroups.SUBTITLES.subs=function(t,e){return void 0===e&&(e={}),t.reduce(function(t,r){var i,n,a,s,u=r.attributes.lang||"text";return t[u]?t:(t[u]={language:u,default:!1,autoselect:!1,playlists:E([(i=r,a=i.attributes,s=i.segments,void 0===s&&(s=[{uri:a.baseUrl,timeline:a.periodIndex,resolvedUri:a.baseUrl||"",duration:a.sourceDuration,number:0}],a.duration=a.sourceDuration),{attributes:(n={NAME:a.id,BANDWIDTH:a.bandwidth},n["PROGRAM-ID"]=1,n),uri:"",endList:"static"===(a.type||"static"),timeline:a.periodIndex,resolvedUri:a.baseUrl||"",targetDuration:a.duration,segments:s,mediaSequence:s.length?s[0].number:1})],e),uri:""},t)},{})}(c,e)),l},S=function(t,e,r){var i=t.NOW,n=t.clientOffset,a=t.availabilityStartTime,s=t.timescale,u=void 0===s?1:s,o=t.start,c=void 0===o?0:o,l=t.minimumUpdatePeriod,d=(i+n)/1e3+(void 0===l?0:l)-(a+c);return Math.ceil((d*u-e)/r)},D=function(t,e){for(var r=t.type,i=void 0===r?"static":r,n=t.minimumUpdatePeriod,a=void 0===n?0:n,s=t.media,u=void 0===s?"":s,o=t.sourceDuration,c=t.timescale,l=void 0===c?1:c,d=t.startNumber,f=void 0===d?1:d,p=t.periodIndex,m=[],g=-1,h=0;h<e.length;h++){var v=e[h],b=v.d,y=v.r||0,T=v.t||0;g<0&&(g=T),T&&T>g&&(g=T);var E=void 0;if(y<0){var I=h+1;E=I===e.length?"dynamic"===i&&a>0&&u.indexOf("$Number$")>0?S(t,g,b):(o*l-g)/b:(e[I].t-g)/b}else E=y+1;for(var U=f+m.length+E,O=f+m.length;O<U;)m.push({number:O,duration:b/l,time:g,timeline:p}),g+=b,O++}return m},A=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,R=function(t,e){return t.replace(A,function(t){return function(e,r,i,n){if("$$"===e)return"$";if(void 0===t[r])return e;var a=""+t[r];return"RepresentationID"===r?a:(n=i?parseInt(n,10):1,a.length>=n?a:""+new Array(n-a.length+1).join("0")+a)}}(e))},w=function(t,e){var r={RepresentationID:t.id,Bandwidth:t.bandwidth||0},i=t.initialization,n=void 0===i?{sourceURL:"",range:""}:i,a=g({baseUrl:t.baseUrl,source:R(n.sourceURL,r),range:n.range});return function(t,e){return t.duration||e?t.duration?v(t):D(t,e):[{number:t.startNumber||1,duration:t.sourceDuration,time:0,timeline:t.periodIndex}]}(t,e).map(function(e){r.Number=e.number,r.Time=e.time;var i=R(t.media||"",r);return{uri:i,timeline:e.timeline,duration:e.duration,resolvedUri:m(t.baseUrl||"",i),map:a,number:e.number}})},L=function(t,e){var r=t.duration,i=t.segmentUrls,n=void 0===i?[]:i;if(!r&&!e||r&&e)throw new Error(d);var a,s=n.map(function(e){return function(t,e){var r=t.baseUrl,i=t.initialization,n=void 0===i?{}:i,a=g({baseUrl:r,source:n.sourceURL,range:n.range}),s=g({baseUrl:r,source:e.media,range:e.mediaRange});return s.map=a,s}(t,e)});return r&&(a=v(t)),e&&(a=D(t,e)),a.map(function(t,e){if(s[e]){var r=s[e];return r.timeline=t.timeline,r.duration=t.duration,r.number=t.number,r}}).filter(function(t){return t})},P=function(t){var e,r,i=t.attributes,a=t.segmentInfo;a.template?(r=w,e=n(i,a.template)):a.base?(r=b,e=n(i,a.base)):a.list&&(r=L,e=n(i,a.list));var s={attributes:i};if(!r)return s;var u=r(e,a.timeline);if(e.duration){var o=e,c=o.duration,l=o.timescale,d=void 0===l?1:l;e.duration=c/d}else u.length?e.duration=u.reduce(function(t,e){return Math.max(t,Math.ceil(e.duration))},0):e.duration=0;return s.attributes=e,s.segments=u,a.base&&e.indexRange&&(s.sidx=u[0],s.segments=[]),s},N=function(t,e){return s(t.childNodes).filter(function(t){return t.tagName===e})},x=function(t){return t.textContent.trim()},C=function(t){var e=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(t);if(!e)return 0;var r=e.slice(1),i=r[0],n=r[1],a=r[2],s=r[3],u=r[4],o=r[5];return 31536e3*parseFloat(i||0)+2592e3*parseFloat(n||0)+86400*parseFloat(a||0)+3600*parseFloat(s||0)+60*parseFloat(u||0)+parseFloat(o||0)},M={mediaPresentationDuration:function(t){return C(t)},availabilityStartTime:function(t){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e=t)&&(e+="Z"),Date.parse(e)/1e3;var e},minimumUpdatePeriod:function(t){return C(t)},timeShiftBufferDepth:function(t){return C(t)},start:function(t){return C(t)},width:function(t){return parseInt(t,10)},height:function(t){return parseInt(t,10)},bandwidth:function(t){return parseInt(t,10)},startNumber:function(t){return parseInt(t,10)},timescale:function(t){return parseInt(t,10)},duration:function(t){var e=parseInt(t,10);return isNaN(e)?C(t):e},d:function(t){return parseInt(t,10)},t:function(t){return parseInt(t,10)},r:function(t){return parseInt(t,10)},DEFAULT:function(t){return t}},F=function(t){return t&&t.attributes?s(t.attributes).reduce(function(t,e){var r=M[e.name]||M.DEFAULT;return t[e.name]=r(e.value),t},{}):{}};var j={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},X=function(t,e){return e.length?a(t.map(function(t){return e.map(function(e){return m(t,x(e))})})):t},G=function(t){var e=N(t,"SegmentTemplate")[0],r=N(t,"SegmentList")[0],i=r&&N(r,"SegmentURL").map(function(t){return n({tag:"SegmentURL"},F(t))}),a=N(t,"SegmentBase")[0],s=r||e,u=s&&N(s,"SegmentTimeline")[0],o=r||a||e,c=o&&N(o,"Initialization")[0],l=e&&F(e);l&&c?l.initialization=c&&F(c):l&&l.initialization&&(l.initialization={sourceURL:l.initialization});var d={template:l,timeline:u&&N(u,"S").map(function(t){return F(t)}),list:r&&n(F(r),{segmentUrls:i,initialization:F(c)}),base:a&&n(F(a),{initialization:F(c)})};return Object.keys(d).forEach(function(t){d[t]||delete d[t]}),d},z=function(t){return t.reduce(function(t,r){var i=F(r),n=j[i.schemeIdUri];if(n){t[n]={attributes:i};var a=N(r,"cenc:pssh")[0];if(a){var s=x(a),u=s&&function(t){for(var r=e.atob(t),i=new Uint8Array(r.length),n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i}(s);t[n].pssh=u}}return t},{})},q=function(t,e,r){return function(i){var s=F(i),u=X(e,N(i,"BaseURL")),o=N(i,"Role")[0],c={role:F(o)},l=n(t,s,c),d=z(N(i,"ContentProtection"));Object.keys(d).length&&(l=n(l,{contentProtection:d}));var f=G(i),p=N(i,"Representation"),m=n(r,f);return a(p.map(function(t,e,r){return function(i){var a=N(i,"BaseURL"),s=X(e,a),u=n(t,F(i)),o=G(i);return s.map(function(t){return{segmentInfo:n(r,o),attributes:n(u,{baseUrl:t})}})}}(l,u,m)))}},k=function(t,r){void 0===r&&(r={});var i=r,s=i.manifestUri,o=void 0===s?"":s,c=i.NOW,l=void 0===c?Date.now():c,d=i.clientOffset,f=void 0===d?0:d,p=N(t,"Period");if(!p.length)throw new Error(u);var m=F(t),g=X([o],N(t,"BaseURL"));return m.sourceDuration=m.mediaPresentationDuration||0,m.NOW=l,m.clientOffset=f,a(p.map(function(t,r){return function(i,s){var u=X(r,N(i,"BaseURL")),o=F(i),c=parseInt(o.id,10),l=e.isNaN(c)?s:c,d=n(t,{periodIndex:l}),f=N(i,"AdaptationSet"),p=G(i);return a(f.map(q(d,u,p)))}}(m,g)))},V=function(t,r){return void 0===r&&(r={}),O(k(function(t){if(""===t)throw new Error(o);var r=(new e.DOMParser).parseFromString(t,"application/xml"),i=r&&"MPD"===r.documentElement.tagName?r.documentElement:null;if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(c);return i}(t),r).map(P),r.sidxMapping)};
/*! @name m3u8-parser @version 4.4.0 @license Apache-2.0 */
function B(){return(B=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function $(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var H=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var r=this.listeners[t].indexOf(e);return this.listeners[t].splice(r,1),r>-1},e.trigger=function(t){var e,r,i,n=this.listeners[t];if(n)if(2===arguments.length)for(r=n.length,e=0;e<r;++e)n[e].call(this,arguments[1]);else for(i=Array.prototype.slice.call(arguments,1),r=n.length,e=0;e<r;++e)n[e].apply(this,i)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",function(e){t.push(e)})},t}(),_=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return $(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(H),W=function(t){for(var e,r=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},n=r.length;n--;)""!==r[n]&&((e=/([^=]*)=(.*)/.exec(r[n]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),i[e[0]]=e[1]);return i},Y=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}$(e,t);var r=e.prototype;return r.push=function(t){var e,r,i=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce(function(e,r){var i=r(t);return i===t?e:e.concat([i])},[t]).forEach(function(t){for(var n=0;n<i.customParsers.length;n++)if(i.customParsers[n].call(i,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return r={type:"tag",tagType:"inf"},e[1]&&(r.duration=parseFloat(e[1])),e[2]&&(r.title=e[2]),void i.trigger("data",r);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"targetduration"},e[1]&&(r.duration=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"totalduration"},e[1]&&(r.duration=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"version"},e[1]&&(r.version=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"media-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return r={type:"tag",tagType:"playlist-type"},e[1]&&(r.playlistType=e[1]),void i.trigger("data",r);if(e=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"byterange"},e[1]&&(r.length=parseInt(e[1],10)),e[2]&&(r.offset=parseInt(e[2],10)),void i.trigger("data",r);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return r={type:"tag",tagType:"allow-cache"},e[1]&&(r.allowed=!/NO/.test(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"map"},e[1]){var a=W(e[1]);if(a.URI&&(r.uri=a.URI),a.BYTERANGE){var s=a.BYTERANGE.split("@"),u=s[0],o=s[1];r.byterange={},u&&(r.byterange.length=parseInt(u,10)),o&&(r.byterange.offset=parseInt(o,10))}}i.trigger("data",r)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"stream-inf"},e[1]){if(r.attributes=W(e[1]),r.attributes.RESOLUTION){var c=r.attributes.RESOLUTION.split("x"),l={};c[0]&&(l.width=parseInt(c[0],10)),c[1]&&(l.height=parseInt(c[1],10)),r.attributes.RESOLUTION=l}r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))}i.trigger("data",r)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return r={type:"tag",tagType:"media"},e[1]&&(r.attributes=W(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-ENDLIST/.exec(t))i.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return r={type:"tag",tagType:"program-date-time"},e[1]&&(r.dateTimeString=e[1],r.dateTimeObject=new Date(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return r={type:"tag",tagType:"key"},e[1]&&(r.attributes=W(e[1]),r.attributes.IV&&("0x"===r.attributes.IV.substring(0,2).toLowerCase()&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),void i.trigger("data",r);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return r={type:"tag",tagType:"start"},e[1]&&(r.attributes=W(e[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),void i.trigger("data",r);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out-cont"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-in"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);i.trigger("data",{type:"tag",data:t.slice(4)})}}}else i.trigger("data",{type:"comment",text:t.slice(1)})}):this.trigger("data",{type:"uri",uri:t}))},r.addParser=function(t){var e=this,r=t.expression,i=t.customType,n=t.dataParser,a=t.segment;"function"!=typeof n&&(n=function(t){return t}),this.customParsers.push(function(t){if(r.exec(t))return e.trigger("data",{type:"custom",data:n(t),customType:i,segment:a}),!0})},r.addTagMapper=function(t){var e=t.expression,r=t.map;this.tagMappers.push(function(t){return e.test(t)?r(t):t})},e}(H);function K(t){for(var r=e.atob(t||""),i=new Uint8Array(r.length),n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i}var J=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new _,e.parseStream=new Y,e.lineStream.pipe(e.parseStream);var r,i,n=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e),a=[],s={},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},o=0;return e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},e.parseStream.on("data",function(t){var e,c;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(s.byterange=e,e.length=t.length,"offset"in t||(this.trigger("info",{message:"defaulting offset to zero"}),t.offset=0)),"offset"in t&&(s.byterange=e,e.offset=t.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(s.duration=t.duration),0===t.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:K(t.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(i.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,o=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){r={},t.uri&&(r.uri=t.uri),t.byterange&&(r.byterange=t.byterange)},"stream-inf":function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||u,t.attributes?(s.attributes||(s.attributes={}),B(s.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var r=this.manifest.mediaGroups[t.attributes.TYPE];r[t.attributes["GROUP-ID"]]=r[t.attributes["GROUP-ID"]]||{},e=r[t.attributes["GROUP-ID"]],(c={default:/yes/i.test(t.attributes.DEFAULT)}).default?c.autoselect=!0:c.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(c.language=t.attributes.LANGUAGE),t.attributes.URI&&(c.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(c.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(c.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(c.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=c}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){o+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),s.dateTimeString=t.dateTimeString,s.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):this.manifest.targetDuration=t.duration},totalduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+t.duration}):this.manifest.totalDuration=t.duration},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){s.cueOut=t.data},"cue-out-cont":function(){s.cueOutCont=t.data},"cue-in":function(){s.cueIn=t.data}}[t.tagType]||function(){}).call(n)},uri:function(){s.uri=t.uri,a.push(s),!this.manifest.targetDuration||"duration"in s||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),i&&(s.key=i),s.timeline=o,r&&(s.map=r),s={}},comment:function(){},custom:function(){t.segment?(s.custom=s.custom||{},s.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(n)}),e}$(e,t);var r=e.prototype;return r.push=function(t){this.lineStream.push(t)},r.end=function(){this.lineStream.push("\n")},r.addParser=function(t){this.parseStream.addParser(t)},r.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(H);"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Q(t,e){return t(e={exports:{}},e.exports),e.exports}var tt=Q(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,i=/^application\/dash\+xml/i;e.simpleTypeFromSourceType=function(t){return r.test(t)?"hls":i.test(t)?"dash":"application/vnd.videojs.vhs+json"===t?"vhs-json":null}});Z(tt);var et=tt.simpleTypeFromSourceType,rt=Q(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.forEachMediaGroup=function(t,e,r){e.forEach(function(e){for(var i in t.mediaGroups[e])for(var n in t.mediaGroups[e][i]){var a=t.mediaGroups[e][i][n];r(a,e,i,n)}})}});Z(rt);var it=rt.forEachMediaGroup;function nt(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var at=nt(Q(function(t,e){var r,i,n,a,s;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var u=s.parseURL(t);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&"/"!==u.path[0]){var o=i.exec(u.path);u.netLoc=o[1],u.path=o[2]}u.netLoc&&!u.path&&(u.path="/");var c={scheme:u.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=u.netLoc,"/"!==a.path[0]))if(a.path){var l=u.path,d=l.substring(0,l.lastIndexOf("/")+1)+a.path;c.path=s.normalizePath(d)}else c.path=u.path,a.params||(c.params=u.params,a.query||(c.query=u.query));return null===c.path&&(c.path=r.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(c)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s})),st=nt(e),ut=function(t,e){return/^[a-z]+:/i.test(e)?e:(/\/\//i.test(t)||(t=at.buildAbsoluteURL(st.location&&st.location.href||"",t)),at.buildAbsoluteURL(t,e))},ot=function(t,e){t.resolvedUri||(t.resolvedUri=ut(e,t.uri)),t.key&&!t.key.resolvedUri&&(t.key.resolvedUri=ut(e,t.key.uri)),t.map&&!t.map.resolvedUri&&(t.map.resolvedUri=ut(e,t.map.uri))},ct=function(t){var e,r=t.url,i=t.manifestString,n=t.mimeType,a="dash"===et(n)?V(i,{manifestUri:r,clientOffset:0}):function(t){var e=new J;return e.push(t),e.end(),e.manifest}(i);return a.uri=r,a.resolvedUri=r,a.playlists?function(t){for(var e=0;e<t.playlists.length;e++){var r=t.playlists[e];r.uri||(r.uri="placeholder-uri-"+e),r.resolvedUri=ut(t.uri,r.uri),r.segments&&r.segments.forEach(function(e){ot(e,t.uri)})}it(t,["AUDIO"],function(e,r,i,n){e.uri&&(e.resolvedUri=ut(t.uri,e.uri)),e.playlists&&(e.playlists[0].resolvedUri||(e.playlists[0].resolvedUri=t.resolvedUri+"-audio-placeholder-"+i+"-"+n),e.playlists[0].segments.forEach(function(e){ot(e,t.uri)}))})}(a):((e=a).attributes=e.attributes||{},e.segments.forEach(function(t){ot(t,e.uri)})),a},lt=Q(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return t?t.replace(/avc1\.(\d+)\.(\d+)/i,function(t,e,r){return"avc1."+("00"+Number(e).toString(16)).slice(-2)+"00"+("00"+Number(r).toString(16)).slice(-2)}):t},i=function(t){return t.map(r)},n=function(t){void 0===t&&(t="");var e={codecCount:0};e.codecCount=t.split(",").length,e.codecCount=e.codecCount||2;var r=/(^|\s|,)+(avc[13])([^ ,]*)/i.exec(t);return r&&(e.videoCodec=r[2],e.videoObjectTypeIndicator=r[3]),e.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(t),e.audioProfile=e.audioProfile&&e.audioProfile[2],e};e.audioProfileFromDefault=function(t,e){if(!t.mediaGroups.AUDIO||!e)return null;var r=t.mediaGroups.AUDIO[e];if(!r)return null;for(var i in r){var a=r[i];if(a.default&&a.playlists)return n(a.playlists[0].attributes.CODECS).audioProfile}return null},e.mapLegacyAvcCodecs=function(t){return t.replace(/avc1\.(\d+)\.(\d+)/i,function(t){return i([t])[0]})},e.parseCodecs=n,e.translateLegacyCodec=r,e.translateLegacyCodecs=i});Z(lt);var dt=lt.audioProfileFromDefault,ft=lt.mapLegacyAvcCodecs,pt=lt.parseCodecs,mt=(lt.translateLegacyCodec,lt.translateLegacyCodecs,function(t){return(t.playlists?t.playlists:[t]).reduce(function(e,r){if(!r.attributes||!r.attributes.CODECS)return e;var i=pt(r.attributes.CODECS);if(2!==i.codecCount&&r.attributes.AUDIO){var n=dt(t,r.attributes.AUDIO);n&&(i.audioProfile=n,i.codecCount++)}return e[r.resolvedUri]=i,e},{})}),gt=function(t){var e=t.playlists,r=t.uriSuffix,i=void 0===r?"":r,n=e.reduce(function(t,e){var r=t.length,i=JSON.parse(JSON.stringify(e.segments)),n=t.concat(i);return t.length>0&&(n[r].discontinuity=!0),n},[]),a=e.reduce(function(t,e){return e.attributes&&e.attributes.BANDWIDTH&&(!t||e.attributes.BANDWIDTH>t)?e.attributes.BANDWIDTH:t},null),s=e.reduce(function(t,e){return t||(e.attributes?e.attributes.CODECS:null)},null),u={attributes:{},segments:n};a&&(u.attributes.BANDWIDTH=a),s&&(u.attributes.CODECS=s),u.uri="combined-playlist"+i,u.resolvedUri=u.uri,u.playlistType="VOD",u.targetDuration=e.reduce(function(t,e){return t>e.targetDuration?t:e.targetDuration},0),u.endList=!0,u.mediaSequence=0,u.discontinuitySequence=0,u.discontinuityStarts=[];for(var o=0,c=0;c<u.segments.length;c++){var l=u.segments[c];l.discontinuity&&(u.discontinuityStarts.push(c),o++),l.number=c,l.timeline=o}return u},ht=function(t){var e=t.pssh,r=t.audioContentType,i=t.videoContentType,n=t.url,a=t.getLicense;return function(t){var s={audioContentType:r,videoContentType:i,pssh:e};n&&(s.url=n),a&&(s.getLicense=a),t.eme.initializeMediaKeys({keySystems:{"com.widevine.alpha":s}})}},vt=function(i){var n=i.manifests,a=i.targetVerticalResolution,s=i.callback,u=n.map(ct),o=function(t){return t.map(function(t){var r=mt(t);return(t.playlists?t.playlists:[t]).filter(function(t){var i=r[t.resolvedUri];return!i||2===i.codecCount&&!(e.MediaSource&&e.MediaSource.isTypeSupported&&!e.MediaSource.isTypeSupported('video/mp4; codecs="'+ft(t.attributes.CODECS)+'"'))})})}(u);o.forEach(function(t){if(0===t.length)throw new Error("Did not find a supported playlist for each manifest")});for(var c=function(t,e){return t.map(function(t){return 1===t.length?t[0]:t.reduce(function(t,r){return t?r.attributes.RESOLUTION?t.attributes.RESOLUTION?Math.abs(r.attributes.RESOLUTION-e)<Math.abs(t.attributes.RESOLUTION-e)?r:t:r:t.attributes.RESOLUTION?t:Math.abs(r.attributes.BANDWIDTH-4194304)<Math.abs(t.attributes.BANDWIDTH-4194304)?r:t:r},null)})}(o,a),l=function(t,e){if(t.length!==e.length)throw new Error("Invalid number of video playlists for provided manifests");for(var r=t.length,i=[],n=0;n<r;n++){var a=t[n],s=e[n];if(s.attributes.AUDIO&&a.mediaGroups.AUDIO[s.attributes.AUDIO])for(var u=a.mediaGroups.AUDIO[s.attributes.AUDIO],o=Object.keys(u),c=0;c<o.length;c++){var l=u[o[c]];if(l.default&&(l.resolvedUri||l.playlists)){i.push(l.playlists?l.playlists[0]:l);break}}}if(i.length>0&&i.length!==r)throw new Error("Did not find matching audio playlists for all video playlists");return i}(u,c),d=c.concat(l),f=n.map(function(t){return t.mimeType}),p=0;p<l.length;p++)f.push(f[p]);!function(t){var e=t.playlists,i=t.mimeTypes,n=t.callback,a=e.filter(function(t){return!t.segments}).map(function(t){return t.resolvedUri}),s=e.filter(function(t){return t.segments}),u={};if(s.forEach(function(t){u[t.resolvedUri]=t}),a.length){for(var o={},c={},l=0;l<e.length;l++){var d=e[l];o[d.resolvedUri]||(o[d.resolvedUri]=[]),o[d.resolvedUri].push(d),c[d.resolvedUri]=i[l].mimeType}r(a,function(t,e){if(t)n(t);else{for(var r=0;r<a.length;r++)for(var i=a[r],s=o[i],l=e[i],d=c[i],f=ct({url:i,manifestString:l,mimeType:d}),p=0;p<s.length;p++){var m=s[p];u[m.resolvedUri]=f}n(null,u)}})}else n(null,u)}({playlists:d,mimeTypes:f,callback:function(r,i){if(r)s(r);else{d.forEach(function(t){var e=i[t.resolvedUri];t.segments=e.segments,t.contentProtection=e.contentProtection});var a={manifestObject:function(t){var r=t.videoPlaylist,i=t.audioPlaylist;r=JSON.parse(JSON.stringify(r)),i&&(i=JSON.parse(JSON.stringify(i)));var n=[r],a=i?[i]:null;n[r.uri]=r,a&&(a[i.uri]=i);var s={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:e.location.href,playlists:n};return i&&(s.mediaGroups.AUDIO.audio={default:{autoselect:!0,default:!0,language:"",uri:"combined-audio-playlists",playlists:a}},s.playlists[0].attributes.AUDIO="audio"),s}({videoPlaylist:gt({playlists:c}),audioPlaylist:l.length?gt({playlists:l,uriSuffix:"-audio"}):null})},o=function(t){for(var e=t.videoPlaylists,r=t.manifestObjects,i=[],n=0;n<e.length;n++){var a=e[n],s=r[n],u=mt(s)[a.resolvedUri];if(u){var o={};u.videoCodec&&(o.video='video/mp4; codecs="'+u.videoCodec+u.videoObjectTypeIndicator+'"'),u.audioProfile&&(o.audio='audio/mp4; codecs="mp4a.40.'+u.audioProfile+'"'),i.push(o)}else i.push(null)}return i}({videoPlaylists:c,manifestObjects:u}),f=function(e){var r=e.videoPlaylists,i=e.audioPlaylists,n=e.audioAndVideoTypes,a=e.keySystems;if(!a.reduce(function(t,e){return t||!!e},!1))return null;for(var s=[],u=0;u<r.length;u++){var o=a[u];if(o){var c=o["com.widevine.alpha"];if(c&&n[u]&&(n[u].video||n[u].audio)){var l="object"==typeof c?c.url:c,d="object"==typeof c?c.getLicense:null,f=r[u],p=i[u],m=f.contentProtection&&f.contentProtection["com.widevine.alpha"]?f.contentProtection["com.widevine.alpha"].pssh:null,g=p.contentProtection&&p.contentProtection["com.widevine.alpha"]?p.contentProtection["com.widevine.alpha"].pssh:null,h={audioContentType:n[u].audio,videoContentType:n[u].video};if(l&&(h.url=l),d&&(h.getLicense=d),m){var v=t.mergeOptions(h,{pssh:m});s.push(ht(v))}if(g){var b=t.mergeOptions(h,{pssh:g});s.push(ht(b))}}}}return function(t){s.forEach(function(e){e(t)})}}({videoPlaylists:c,audioPlaylists:l,audioAndVideoTypes:o,keySystems:n.map(function(t){return t.keySystems})});f&&(a.initializeKeySystems=f),s(null,a)}}})},bt=function(t){t&&function(t){var e=t.manifests,i=t.targetVerticalResolution,n=t.callback,a=function(t){if(!t||!t.length)return"No sources provided";for(var e=0;e<t.length;e++){if(!t[e].url)return"All manifests must include a URL";if(!t[e].mimeType)return"All manifests must include a mime type"}return null}(e);if(a)n({message:a});else{var s=e.map(function(t){return t.url});r(s,function(t,r){if(t)n(t);else{var a=e.map(function(t){return{url:t.url,manifestString:r[t.url],mimeType:t.mimeType,keySystems:t.keySystems}});try{vt({manifests:a,targetVerticalResolution:i,callback:n})}catch(t){n(t)}}})}}(t)};return(t.registerPlugin||t.plugin)("concat",bt),bt.VERSION="1.0.0",bt});
